\chapter{Sequential Sorting in the MRAM}
\label{sec:mram}

This chapter is concerned with the second phase of parallel sorting where tasklets sort MRAM data independently from each other, that is sequentially.
The sorting algorithm presented herein is a \MS{} since it allows for a stable parallel sorting algorithm and, also, the performance of \MS{} proved to be competitive in sorting WRAM data in \cref{sec:tasklet}.
A challenge in designing a \MS{} for MRAM data is the management of data transfers between the large MRAM and the small WRAM of a DPU.
A key aspect of the transfer management is the use of the sequential reader, that is a software abstraction provided by UPMEM which simplifies moving data from the MRAM to the WRAM.
\Cref{sec:mram:seq_reader} presents the advantages of the sequential reader and explains its usage and inner workings.
\Cref{sec:mram:triple} addresses the division of the WRAM into several buffers which are needed by both sequential readers and the MRAM \MS{} itself.
Finally, \cref{sec:mram:merge} deals with the sorting algorithm itself, shows how the sequential reader can be improved upon, and concludes with an analysis of the performance.
Every measurement shown in this \lcnamecref{sec:mram} was repeated a thousand times, which is a sufficient number given the large inputs and the low runtime variance of \MS{}.

%\begin{itemize}
%	\item
%	Sequential Reader
%	\begin{itemize}
%		\item
%		Verbesserungspotential
%		\begin{itemize}
%			\item
%			\lstinline|last_item| auch für den straighten Leser.
%			Das macht es billiger zu prüfen, wann die erste Stufe verlassen werden muss.
%			Außerdem macht sie das Entleeren eines Laufes billiger, da leicht das wahre Ende des Puffers festgestellt werden kann.
%		\end{itemize}
%	\end{itemize}
%
%	\item
%	Does reading less if the end is reached improve performance? No!
%
%	\item
%	Kann Flushed durch vollständiges Lesen des Puffers verschnellert werden? Ja! Siehe Erweiterung durch den reinen C-Leser
%
%	\item
%	Was sich alles lohnen könnte:
%	\begin{itemize}
%		\item
%		Aufweichung der triple buffer zum Erstellen längerer Startläufe
%	\end{itemize}
%\end{itemize}

\clearpage
\input{mram_reader}

\clearpage
\input{mram_triple}

\clearpage
\input{mram_merge}
