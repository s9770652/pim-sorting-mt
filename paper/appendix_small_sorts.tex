\pgfplotstableread{data/shell/no_third_step.txt}{\tableshellnothirdstep}
\pgfplotstableread{data/shell/h1=7.txt}{\tableshellvii}
\pgfplotstableread{data/shell/h1=8.txt}{\tableshellviii}
\pgfplotstableread{data/shell/h1=9.txt}{\tableshellix}
\pgfplotstableread{data/shell/h1=10.txt}{\tableshellx}
\pgfplotstableread{data/shell/h1=11.txt}{\tableshellxi}
\pgfplotstableread{data/shell/h1=12.txt}{\tableshellxii}
\pgfplotstableread{data/shell/h1=13.txt}{\tableshellxiii}
\pgfplotstableread{data/shell/h1=14.txt}{\tableshellxiv}
\pgfplotstableread{data/shell/h1=15.txt}{\tableshellxv}
\pgfplotstableread{data/shell/h1=16.txt}{\tableshellxvi}
\pgfplotstableread{data/shell/h1=17.txt}{\tableshellxvii}
\pgfplotstableread{data/shell/h1=23,h2=10,h3=4.txt}{\tableshellciura}
\pgfplotstableread{data/shell/quick.txt}{\tableshellquick}
\pgfplotstableread{data/shell/custom.txt}{\tableshellcustom}

\NewDocumentCommand{\shellscatter}{m m}{
	\addplot+ plot [select coords between index={#1}{#1}, forget plot, very thick, draw=black] table [x=µ_#2, y=σ_#2] {\tableshellnothirdstep};
	\ifnumless{#2}{7}{
		\addplot+ plot [select coords between index={#1}{#1}, forget plot] table [x=µ_#2, y=σ_#2] {\tableshellvii};
	}{}
	\ifnumless{#2}{8}{
		\addplot+ plot [select coords between index={#1}{#1}, forget plot] table [x=µ_#2, y=σ_#2] {\tableshellviii};
	}{}
	\ifnumless{#2}{9}{
		\addplot+ plot [select coords between index={#1}{#1}, forget plot] table [x=µ_#2, y=σ_#2] {\tableshellix};
	}{}
	\addplot+ plot [select coords between index={#1}{#1}, forget plot] table [x=µ_#2, y=σ_#2] {\tableshellx};
	\addplot+ plot [select coords between index={#1}{#1}, forget plot] table [x=µ_#2, y=σ_#2] {\tableshellxi};
	\addplot+ plot [select coords between index={#1}{#1}, forget plot] table [x=µ_#2, y=σ_#2] {\tableshellxii};
	\addplot+ plot [select coords between index={#1}{#1}, forget plot] table [x=µ_#2, y=σ_#2] {\tableshellxiii};
	\addplot+ plot [select coords between index={#1}{#1}, forget plot] table [x=µ_#2, y=σ_#2] {\tableshellxiv};
	\addplot+ plot [select coords between index={#1}{#1}, forget plot] table [x=µ_#2, y=σ_#2] {\tableshellxv};
	\addplot+ plot [select coords between index={#1}{#1}, forget plot] table [x=µ_#2, y=σ_#2] {\tableshellxvi};
	\addplot+ plot [select coords between index={#1}{#1}] table [x=µ_#2, y=σ_#2] {\tableshellxvii};
}

\begin{figure}[p]
	\begin{tikzpicture}[plot]
		\begin{groupplot}[
			width=0.4358\linewidth,
			group/group size=2 by 3,
			groupplot xlabel={Mean [\(10^4\) Cycles]},
			groupplot ylabel={Standard Deviation [Cycles]},
			scaled x ticks=base 10:-4,
			xtick scale label code/.code={},  % removes exponent underneath the axis
			/tikz/only marks,
			legend columns=-1,
		]
			\nextgroupplot[title={Input Length \(n = 24\)}]
			\pgfplotsinvokeforeach{3,...,9}{
				\shellscatter{0}{#1}
			}
			\pgfplotsset{cycle list shift=1}
			\addplot+ plot [select coords between index={0}{0}] table [x=µ_QuickRec, y=σ_QuickRec] {\tableshellquick};
			%
			\nextgroupplot[title={Input Length \(n = 32\)}]
			\pgfplotsinvokeforeach{3,...,9}{
				\shellscatter{1}{#1}
			}
			\addplot+ plot [select coords between index={1}{1}] table [x=µ_Ciura, y=σ_Ciura] {\tableshellciura};
			\addplot+ plot [select coords between index={1}{1}] table [x=µ_QuickRec, y=σ_QuickRec] {\tableshellquick};
			%
			\nextgroupplot[title={Input Length \(n = 48\)}]
			\pgfplotsinvokeforeach{3,...,9}{
				\shellscatter{2}{#1}
			}
			\addplot+ plot [select coords between index={2}{2}] table [x=µ_Ciura, y=σ_Ciura] {\tableshellciura};
			\addplot+ plot [select coords between index={2}{2}] table [x=µ_QuickRec, y=σ_QuickRec] {\tableshellquick};
			%
			\nextgroupplot[title={Input Length \(n = 64\)}]
			\pgfplotsinvokeforeach{3,...,9}{
				\shellscatter{3}{#1}
			}
			\addplot+ plot [select coords between index={3}{3}] table [x=µ_Ciura, y=σ_Ciura] {\tableshellciura};
			\addplot+ plot [select coords between index={3}{3}] table [x=µ_QuickRec, y=σ_QuickRec] {\tableshellquick};
			%
			\nextgroupplot[title={Input Length \(n = 96\)}]
			\pgfplotsinvokeforeach{3,...,9}{
				\shellscatter{4}{#1}
			}
			\addplot+ plot [select coords between index={4}{4}] table [x=µ_Ciura, y=σ_Ciura] {\tableshellciura};
			\addplot+ plot [select coords between index={4}{4}] table [x=µ_QuickRec, y=σ_QuickRec] {\tableshellquick};
			%
			\nextgroupplot[title={Input Length \(n = 128\)}, legend to name=leg:shell_vs_quick]
			\legend{\(h_2 = 3\), \(h_2 = 4\), \(h_2 = 5\), \(h_2 = 6\), \(h_2 = 7\), \(h_2 = 8\), \(h_2 = 9\), Ciura, Quick}
			\pgfplotsinvokeforeach{3,...,9}{
				\shellscatter{5}{#1}
			}
			\addplot+ plot [select coords between index={5}{5}] table [x=µ_Ciura, y=σ_Ciura] {\tableshellciura};
			\addplot+ plot [select coords between index={5}{5}] table [x=µ_QuickRec, y=σ_QuickRec] {\tableshellquick};
		\end{groupplot}
	\end{tikzpicture}

	\hfil\pgfplotslegendfromname{leg:shell_vs_quick}\hfil
	\caption{
	}
\end{figure}

\NewDocumentCommand{\shellscattern}{m m}{
	\addplot+ plot [select coords between index={#1}{#1}, forget plot] table [x=µ_#2, y expr={6}] {\tableshellnothirdstep};
	\ifnumless{#2}{7}{
		\addplot+ plot [select coords between index={#1}{#1}, forget plot] table [x=µ_#2, y expr={7}] {\tableshellvii};
	}{}
	\ifnumless{#2}{8}{
		\addplot+ plot [select coords between index={#1}{#1}, forget plot] table [x=µ_#2, y expr={8}] {\tableshellviii};
	}{}
	\ifnumless{#2}{9}{
		\addplot+ plot [select coords between index={#1}{#1}, forget plot] table [x=µ_#2, y expr={9}] {\tableshellix};
	}{}
	\addplot+ plot [select coords between index={#1}{#1}] table [x=µ_#2, y expr={10}, forget plot] {\tableshellx};
	\addplot+ plot [select coords between index={#1}{#1}] table [x=µ_#2, y expr={11}, forget plot] {\tableshellxi};
	\addplot+ plot [select coords between index={#1}{#1}] table [x=µ_#2, y expr={12}, forget plot] {\tableshellxii};
	\addplot+ plot [select coords between index={#1}{#1}] table [x=µ_#2, y expr={13}, forget plot] {\tableshellxiii};
	\addplot+ plot [select coords between index={#1}{#1}] table [x=µ_#2, y expr={14}, forget plot] {\tableshellxiv};
	\addplot+ plot [select coords between index={#1}{#1}] table [x=µ_#2, y expr={15}, forget plot] {\tableshellxv};
	\addplot+ plot [select coords between index={#1}{#1}] table [x=µ_#2, y expr={16}, forget plot] {\tableshellxvi};
	\addplot+ plot [select coords between index={#1}{#1}] table [x=µ_#2, y expr={17}] {\tableshellxvii};
}

\begin{figure}[p]
	\begin{tikzpicture}[plot]
		\begin{groupplot}[
			width=0.4358\linewidth,
			group/group size=2 by 3,
			groupplot xlabel={Mean [\(10^4\) Cycles]},
			groupplot ylabel={\(h_1\)},
			scaled x ticks=base 10:-4,
			xtick scale label code/.code={},  % removes exponent underneath the axis
			ytick={6, 7, 9, ..., 17},
			yticklabels={/, \(7\), \(9\), \(...\), \(17\)},
			/tikz/only marks,
			legend columns=-1,
		]
			\nextgroupplot[title={Input Length \(n = 24\)}]
			\pgfplotsinvokeforeach{3,...,9}{
				\shellscattern{0}{#1}
			}
			%
			\nextgroupplot[title={Input Length \(n = 32\)}]
			\pgfplotsinvokeforeach{3,...,9}{
				\shellscattern{1}{#1}
			}
			%
			\nextgroupplot[title={Input Length \(n = 48\)}]
			\pgfplotsinvokeforeach{3,...,9}{
				\shellscattern{2}{#1}
			}
			%
			\nextgroupplot[title={Input Length \(n = 64\)}]
			\pgfplotsinvokeforeach{3,...,9}{
				\shellscattern{3}{#1}
			}
			%
			\nextgroupplot[title={Input Length \(n = 96\)}]
			\pgfplotsinvokeforeach{3,...,9}{
				\shellscattern{4}{#1}
			}
			%
			\nextgroupplot[title={Input Length \(n = 128\)}, legend to name=leg:shell_three_rounds]
			\legend{\(h_2 = 3\), \(h_2 = 4\), \(h_2 = 5\), \(h_2 = 6\), \(h_2 = 7\), \(h_2 = 8\), \(h_2 = 9\)}
			\pgfplotsinvokeforeach{3,...,9}{
				\shellscattern{5}{#1}
			}
		\end{groupplot}
	\end{tikzpicture}

	\hfil\pgfplotslegendfromname{leg:shell_three_rounds}\hfil
	\caption{
	}
\end{figure}

\begin{figure}
	\begin{tikzpicture}[plot]
		\begin{groupplot}[
			width=\linewidth,
			groupplot xlabel={Input Length \(n\)},
			ylabel={Speed-up},
			xtick={24, 32, ..., 128},
			minor xtick=data,
			ymin=0.2,
			legend columns=-1,
		]
			\nextgroupplot
			\plotspeedup{InsertSent}{QuickRec}{\tableshellcustom}
			\plotspeedup{ShellCustom}{QuickRec}{\tableshellcustom}
		\end{groupplot}
	\end{tikzpicture}
\end{figure}

\begin{figure}
	\begin{tikzpicture}[plot]
		\begin{groupplot}[
			width=0.4358\linewidth,
			group/group size=2 by 1,
			groupplot xlabel={Input Length \(n\)},
			xtick distance=16,
			minor xtick=data,
			legend columns=-1,
		]
			\nextgroupplot[ylabel=Cycles / \(n \lb n\), ymin=0, legend to name=leg:quick_vs_insert_vs_shell]
			\legend{Insertion, Shell, Quick}
			\plotpernlogn{InsertSent}{\tableshellcustom}
			\plotpernlogn{ShellCustom}{\tableshellcustom}
			\plotpernlogn{QuickRec}{\tableshellcustom}
			%
			\nextgroupplot[ylabel=Speed-up]
			\plotspeedup{InsertSent}{QuickRec}{\tableshellcustom}
			\plotspeedup{ShellCustom}{QuickRec}{\tableshellcustom}
		\end{groupplot}
	\end{tikzpicture}

	\hfil\pgfplotslegendfromname{leg:quick_vs_insert_vs_shell}\hfil
\end{figure}


\begin{description}
	\item[r0] start
	\item[r1] end
	\item[r23] return address
\end{description}
\begin{verbatim}
insertion_sort_nosentinel:
    jleu r0, r1, .LBB2_1  // Continue if array of positive length …
.LBB2_8:
    jump r23  // … else leave the function.
.LBB2_1:
    move r2, r0, true, .LBB2_2  // i ← start; Jump to beginning of outer loop.
.LBB2_5:
    move r4, r5  // ?
.LBB2_7:
    add r2, r2, 4  // i++
    sw r4, 0, r3  // *curr ← to_sort
    jgtu r2, r1, .LBB2_8  // If i > end, terminate.
.LBB2_2:  // Beginning of outer loop.
    lw r3, r2, 0  // to_sort ← *i;
    add r5, r2, -4  // prev ← i - 1
    move r4, r2  // curr ← i
    jltu r5, r0, .LBB2_7  // If prev < start, skip to the next iteration of the outer loop.
    move r5, r2  // (prev + 1) ← i
.LBB2_4:
    lw r6, r5, -4  // *prev
    jleu r6, r3, .LBB2_5  // If *prev > to_sort, terminate inner loop.
    add r4, r5, -4  // Store prev.
    add r7, r5, -8  // Store prev--.
    sw r5, 0, r6  // *curr ← *prev
    move r5, r4  // curr ← prev
    jgeu r7, r0, .LBB2_4  // If prev >= start, continue with the next iteration of the inner loop.
    jump .LBB2_7  // Continue with the next iteration of the outer loop.
\end{verbatim}

\begin{verbatim}
insertion_sort_sentinel:
    jleu r0, r1, .LBB3_1  // Continue if array of positive length …
.LBB3_5:
    jump r23  // … else leave the function.
.LBB3_4:
    add r0, r0, 4  // i++
    sw r3, 0, r2  // *curr ← to_sort
    jgtu r0, r1, .LBB3_5  // If i > end, leave the function.
.LBB3_1:
    lw r2, r0, 0  // to_sort ← *i
    lw r4, r0, -4  // *prev
    move r3, r0  // curr ← i
    jleu r4, r2, .LBB3_4  // If *prev > to_sort, terminate inner loop.
    move r3, r0  // ???
.LBB3_3:
    sw r3, 0, r4  // *curr ← *prev
    lw r4, r3, -8  // *(prev - 1)
    add r3, r3, -4  // curr ← prev
    jgtu r4, r2, .LBB3_3  // If *(prev - 1) > to_sort, continue with the next iteration of the inner loop.
    jump .LBB3_4  // Leave inner loop.
\end{verbatim}